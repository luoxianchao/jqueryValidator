/*
* jQuery Validator Plugin
*
* @copyright	2013 Rain Lee <raincious@gmail.com>
* @author		Rain Lee <raincious@gmail.com>
* @package		jQuery.validator
* @version		0.0 prototype
* 
* Copyright (c) 2013, Rain Lee
* All rights reserved.
* 
* Redistribution and use in source and binary forms, with or without
* modification, are permitted provided that the following conditions are met: 
* 
* 1. Redistributions of source code must retain the above copyright notice, this
*    list of conditions and the following disclaimer. 
* 2. Redistributions in binary form must reproduce the above copyright notice,
*    this list of conditions and the following disclaimer in the documentation
*    and/or other materials provided with the distribution. 
* 
* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
* ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
* WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
* DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
* ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
* (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
* LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
* ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
* (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
* SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
* 
* The views and conclusions contained in the software and documentation are those
* of the authors and should not be interpreted as representing official policies, 
* either expressed or implied, of the FreeBSD Project.
* 
*/

!function(t){var e=function(e,i){var r=!1,a=this;a.onSubmit=function(){},a.onWait=a.onPassed=a.onError=function(){},a.data={lastErrPos:{}};var s={formats:null,inputs:[],binds:{},methods:{length:function(t,e,i){return(!e||t.length<=e)&&(!i||t.length>=i)?!0:void 0},compare:function(t,e,i){return(!e||e>=t)&&(!i||t>=i)?!0:void 0}},events:{Wait:a.onWait,Passed:a.onPassed,Errored:a.onError}},n={WAIT:1,PASSED:2,INVALID:3,VERIFY:4,GET:5,TEST:6},o=function(){if(r)return l("Inited, cannot reinit"),!1;if("undefined"==typeof e)return l("Form must be specified"),!1;if(!e.is("form"))return l("Target not a form"),!1;if("undefined"==typeof i)return l("Option must be defined"),!1;if("undefined"==typeof i.Format)return l("Format not set"),!1;s.formats=i.Format;for(var o in i.Format)s.formats[o]=h(i.Format[o]);if("object"==typeof i.Events)for(var o in i.Events)"function"==typeof i.Events[o]?s.events[o]=i.Events[o]:l("Event "+o+" not a closure, ignoring");if("object"==typeof i.Methods)for(var o in i.Methods)"function"==typeof i.Methods[o]?s.methods[o]=i.Methods[o]:l("Method "+o+" not a closure, ignoring");if("object"==typeof i.Bind)for(var o in i.Bind){if("function"!=typeof i.Bind[o])return l("Bind "+o+" not a closure"),!1;s.binds[o]=i.Bind[o]}return e.find("input,textarea,select,button").each(function(){var e=t(this),i=function(){},r=function(){},a=function(){},o=function(){},h=function(){},l=function(){},g={Max:e.data("validator-maxlength")||e.data("va-max")||0,Min:e.data("validator-minlength")||e.data("va-min")||0,Type:e.data("validator-type")||e.data("va-type")||"",Method:e.data("validator-method")||e.data("va-method")||"length",Resulter:e.data("validator-resulter")||e.data("va-show")||"",WrongCSS:e.data("validator-wrong")||e.data("va-error")||"",WorkingCSS:e.data("validator-working")||e.data("va-working")||"",msgResulter:e.data("validator-messager")||e.data("va-msgr")||"",WrongMSG:e.data("validator-message")||e.data("va-msg")||"",hook:function(){return n.PASSED},setWrong:function(){},dismissWrong:function(){},setWorking:function(){},dismissWorking:function(){},validated:function(){}};if(g.Resulter&&(g.ResulterObj=t(g.Resulter)),g.msgResulter&&(g.msgResulterObj=t(g.msgResulter)),"object"==typeof g.ResulterObj&&(i=function(){g.ResulterObj.addClass(g.WrongCSS)},r=function(){g.ResulterObj.removeClass(g.WrongCSS)},a=function(){g.ResulterObj.addClass(g.WorkingCSS)},o=function(){g.ResulterObj.removeClass(g.WorkingCSS)}),"object"==typeof g.msgResulterObj){var p=g.msgResulterObj.text();h=function(){g.msgResulterObj.text(g.WrongMSG)},l=function(){g.msgResulterObj.text(p)}}for(var c in s.binds)if(e.is(t(c))){g.hook=s.binds[c];break}e.validate=function(t){switch(t){case n.GET:var p=e.validated;return"undefined"==typeof p?e.validate(n.VERIFY):p;case n.VERIFY:var p=e.validate();return d(e.val(),g.Max,g.Min,g.Type,g.Method)?e.validate(n.PASSED):e.validate(n.INVALID);case n.TEST:return d(e.val(),g.Max,g.Min,g.Type,g.Method)?n.PASSED:n.INVALID;default:switch(t){case n.WAIT:a(),s.events.Wait(e);break;case n.PASSED:r(),l(),o(),s.events.Passed(e);break;case n.INVALID:i(),h(),o(),s.events.Errored(e)}return e.validated=t,t}};var u=function(){return e.validate(n.WAIT),g.hook(e,function(t){t?e.validate(n.PASSED):e.validate(n.INVALID)})},f=function(){if(e["validate-tested"]!==!0&&e.validate(n.TEST)==n.PASSED)return e["validate-tested"]=!0,n.WAIT;if(e["validate-tested"]===!0&&e.validate(n.VERIFY)==n.PASSED)switch(u()){case n.PASSED:return e.validate(n.PASSED);case n.INVALID:return e.validate(n.PASSED)}};e.change(f),e.keyup(f),e.click(f),e.validator=g,s.inputs.push(e)}),e.submit(function(){return g()?(a.onSubmit(!0),!0):(a.onSubmit(!1),!1)}),r=!0,!0},h=function(t){return t.replace(/\{/g,"").replace(/\}/g,"").replace(/\\x/g,"\\u").match("/(.*)/")[1]},l=function(t){void 0!=typeof console&&console.log("[Validator] validator stopped due to a problem: "+t+".")},g=function(){var t=!0;for(var e in s.inputs)s.inputs[e].validate(n.GET)!=n.PASSED&&(t&&(a.data.lastErrPos=s.inputs[e].position()),t=!1);return t&&(a.data.lastErrPos={}),t},d=function(t,e,i,r,a){return r&&"undefined"!=typeof s.formats[r]&&!t.match(s.formats[r])?!1:"function"==typeof s.methods[a]?s.methods[a](t,e,i)?!0:!1:(l("Method "+a+" not found."),void 0)};o()};t.fn.validator=function(i,r){var a={};a="undefined"!=typeof r?{topOffset:"undefined"!=typeof r.topOffset?r.topOffset:50}:{topOffset:50};var s=new e(this,i);return s.onSubmit=function(e){e||"undefined"==typeof s.data.lastErrPos.top||t("html, body").animate({scrollTop:s.data.lastErrPos.top-a.topOffset},1e3)},s}}(jQuery);