/*
* jQuery Validator Plugin
*
* @copyright	2013 Rain Lee <raincious@gmail.com>
* @author		Rain Lee <raincious@gmail.com>
* @package		jQuery.validator
* @version		0.0 prototype
* 
* Copyright (c) 2013, Rain Lee
* All rights reserved.
* 
* Redistribution and use in source and binary forms, with or without
* modification, are permitted provided that the following conditions are met: 
* 
* 1. Redistributions of source code must retain the above copyright notice, this
*    list of conditions and the following disclaimer. 
* 2. Redistributions in binary form must reproduce the above copyright notice,
*    this list of conditions and the following disclaimer in the documentation
*    and/or other materials provided with the distribution. 
* 
* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
* ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
* WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
* DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
* ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
* (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
* LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
* ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
* (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
* SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
* 
* The views and conclusions contained in the software and documentation are those
* of the authors and should not be interpreted as representing official policies, 
* either expressed or implied, of the FreeBSD Project.
* 
*/

!function(e){var t=function(t,i){var a=!1,n=this;n.onSubmit=function(){},n.onWait=n.onPassed=n.onError=function(){},n.data={lastErrPos:{}};var o={formats:null,inputs:[],binds:{},methods:{length:function(e,t,i){return(!t||e.length<=t)&&(!i||e.length>=i)?!0:void 0},compare:function(e,t,i){return(!t||t>=e)&&(!i||e>=i)?!0:void 0},equal:function(t,i){return t==e(i).val()?!0:void 0}},events:{Wait:n.onWait,Passed:n.onPassed,Errored:n.onError}},r={WAIT:1,PASSED:2,INVALID:3,VERIFY:4,GET:5,TEST:6},s=function(){if(a)return c("Inited, cannot reinit"),!1;if("undefined"==typeof t)return c("Form must be specified"),!1;if(!t.is("form"))return c("Target not a form"),!1;if("undefined"==typeof i)return c("Option must be defined"),!1;if("undefined"==typeof i.Format)return c("Format not set"),!1;o.formats=i.Format;for(var s in i.Format)o.formats[s]=l(i.Format[s]);if("object"==typeof i.Events)for(var s in i.Events)"function"==typeof i.Events[s]?o.events[s]=i.Events[s]:c("Event "+s+" not a closure, ignoring");if("object"==typeof i.Methods)for(var s in i.Methods)"function"==typeof i.Methods[s]?o.methods[s]=i.Methods[s]:c("Method "+s+" not a closure, ignoring");if("object"==typeof i.Binds)for(var s in i.Binds){if("function"!=typeof i.Binds[s])return c("Bind "+s+" not a closure"),!1;o.binds[s]=i.Binds[s]}return t.find("input,textarea,select,button").each(function(){var t=e(this),i=function(){},a=function(){},n=function(){},s=function(){},l=function(){},c=function(){},u=function(){},h={Max:t.data("validator-maxlength")||t.data("va-max")||0,Min:t.data("validator-minlength")||t.data("va-min")||0,Type:t.data("validator-type")||t.data("va-type")||"",Method:t.data("validator-method")||t.data("va-method")||"length",Resulter:t.data("validator-resulter")||t.data("va-show")||"",WrongCSS:t.data("validator-wrong")||t.data("va-error")||"",WorkingCSS:t.data("validator-working")||t.data("va-working")||"",msgResulter:t.data("validator-messager")||t.data("va-msgr")||"",WrongMSG:t.data("validator-message")||t.data("va-msg")||"",hook:function(){return r.PASSED},setWrong:function(){},dismissWrong:function(){},setWorking:function(){},dismissWorking:function(){},validated:function(){}};if(h.Resulter&&(h.ResulterObj=e(h.Resulter)),h.msgResulter&&(h.msgResulterObj=e(h.msgResulter)),"object"==typeof h.ResulterObj&&(i=function(){h.ResulterObj.addClass(h.WrongCSS)},a=function(){h.ResulterObj.removeClass(h.WrongCSS)},n=function(){h.ResulterObj.addClass(h.WorkingCSS)},s=function(){h.ResulterObj.removeClass(h.WorkingCSS)}),"object"==typeof h.msgResulterObj){var g=h.msgResulterObj.text();l=function(e){e?h.msgResulterObj.text(e):h.msgResulterObj.text(g)},c=function(){l(h.WrongMSG.replace("{max}",h.Max).replace("{min}",h.Min))},u=function(){h.msgResulterObj.text(g)}}for(var p in o.binds)if(t.is(e(p))){h.hook=o.binds[p];break}t.message=l,t.validate=function(e){switch(e){case r.GET:var l=t.validated;return"undefined"==typeof l?t.validate(r.VERIFY):l;case r.VERIFY:var l=t.validate();return d(t.val(),h.Max,h.Min,h.Type,h.Method)?t.validate(r.PASSED):t.validate(r.INVALID);case r.TEST:return d(t.val(),h.Max,h.Min,h.Type,h.Method)?r.PASSED:r.INVALID;default:switch(e){case r.WAIT:n(),o.events.Wait(t);break;case r.PASSED:a(),u(),s(),o.events.Passed(t);break;case r.INVALID:i(),c(),s(),o.events.Errored(t)}return t.validated=e,e}};var f=function(){return t.validate(r.WAIT),h.hook(t,function(e){e?t.validate(r.PASSED):t.validate(r.INVALID)})},m=function(){if(t.validate(r.VERIFY)==r.PASSED)switch(f()){case r.PASSED:return t.validate(r.PASSED);case r.INVALID:return t.validate(r.PASSED)}},C=function(){return t["validate-tested"]!==!0&&t.validate(r.TEST)==r.PASSED?(t["validate-tested"]=!0,r.WAIT):t["validate-tested"]===!0?m():void 0};t.change(m),t.keyup(C),t.validator=h,o.inputs.push(t)}),t.submit(function(){return u()?(n.onSubmit(!0),!0):(n.onSubmit(!1),!1)}),a=!0,!0},l=function(e){return e.replace(/\{/g,"").replace(/\}/g,"").replace(/\\x/g,"\\u").match("/(.*)/")[1]},c=function(e){void 0!=typeof console&&console.log("[Validator] validator stopped due to a problem: "+e+".")},u=function(){var e=!0;for(var t in o.inputs)o.inputs[t].validate(r.GET)!=r.PASSED&&(e&&(n.data.lastErrPos=o.inputs[t].offset()),e=!1);return e&&(n.data.lastErrPos={}),e},d=function(e,t,i,a,n){return a&&"undefined"!=typeof o.formats[a]&&!e.match(o.formats[a])?!1:"function"==typeof o.methods[n]?o.methods[n](e,t,i)?!0:!1:(c("Method "+n+" not found."),void 0)};s()};e.fn.validator=function(i,a){var n={};n="undefined"!=typeof a?{topOffset:"undefined"!=typeof a.topOffset?a.topOffset:50}:{topOffset:50};var o=new t(this,i);return o.onSubmit=function(t){t||"undefined"==typeof o.data.lastErrPos.top||e("html, body").animate({scrollTop:o.data.lastErrPos.top-n.topOffset},1e3)},o}}(jQuery);