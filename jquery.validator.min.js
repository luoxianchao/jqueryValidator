/*
* jQuery Validator Plugin
*
* @copyright	2013 Rain Lee <raincious@gmail.com>
* @author		Rain Lee <raincious@gmail.com>
* @package		jQuery.validator
* @version		0.0 prototype
* 
* Copyright (c) 2013, Rain Lee
* All rights reserved.
* 
* Redistribution and use in source and binary forms, with or without
* modification, are permitted provided that the following conditions are met: 
* 
* 1. Redistributions of source code must retain the above copyright notice, this
*    list of conditions and the following disclaimer. 
* 2. Redistributions in binary form must reproduce the above copyright notice,
*    this list of conditions and the following disclaimer in the documentation
*    and/or other materials provided with the distribution. 
*
* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
* ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
* WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
* DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
* ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
* (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
* LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
* ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
* (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
* SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*
*/
!function(e){var t=function(t,i){var n=!1,s=this,o={formats:null,inputs:[],binds:[]},a={WAIT:1,PASSED:2,INVALID:3,VERIFY:4,GET:5};s.data={lastErrPos:{}};var r=function(){if(n)return c("Inited, cannot reinit"),!1;if("undefined"==typeof t)return c("Form must be specified"),!1;if(!t.is("form"))return c("Target not a form"),!1;if("undefined"==typeof i)return c("Option must be defined"),!1;if("undefined"==typeof i.Format)return c("Format not set"),!1;o.formats=i.Format;for(var s in i.Format)o.formats[s]=l(i.Format[s]);if("object"==typeof i.Bind)for(var s in i.Bind){if("function"!=typeof i.Bind[s])return c("Bind "+s+" not a closure"),!1;o.binds[s]=i.Bind[s]}return t.find("input,textarea,select,button").each(function(){var t=e(this),i=function(){},n=function(){},s=function(){},r=function(){},l=function(){},c=function(){},d={Max:t.data("validator-maxlength")||t.data("va-max"),Min:t.data("validator-minlength")||t.data("va-min"),Type:t.data("validator-type")||t.data("va-type"),Resulter:t.data("validator-resulter")||t.data("va-show"),WrongCSS:t.data("validator-wrong")||t.data("va-error"),WorkingCSS:t.data("validator-working")||t.data("va-working"),msgResulter:t.data("validator-messager")||t.data("va-msgr"),WrongMSG:t.data("validator-message")||t.data("va-msg"),hook:function(){return a.PASSED},setWrong:function(){},dismissWrong:function(){},setWorking:function(){},dismissWorking:function(){},validated:function(){}};if(d.Resulter&&(d.ResulterObj=e(d.Resulter)),d.msgResulter&&(d.msgResulterObj=e(d.msgResulter)),"object"==typeof d.ResulterObj&&(i=function(){d.ResulterObj.addClass(d.WrongCSS)},n=function(){d.ResulterObj.removeClass(d.WrongCSS)},s=function(){d.ResulterObj.addClass(d.WorkingCSS)},r=function(){d.ResulterObj.removeClass(d.WorkingCSS)}),"object"==typeof d.msgResulterObj){var h=d.msgResulterObj.text();l=function(){d.msgResulterObj.text(d.WrongMSG)},c=function(){d.msgResulterObj.text(h)}}for(var f in o.binds)if(t.is(e(f))){d.hook=o.binds[f];break}d.validate=function(e){switch(e){case a.GET:var o=t.data("validated");return"undefined"==typeof o?d.validate(a.VERIFY):o;case a.VERIFY:var o=d.validate();return u(t.val(),d.Max,d.Min,d.Type)?d.validate(a.PASSED):d.validate(a.INVALID);default:switch(e){case a.WAIT:s();break;case a.PASSED:n(),c(),r();break;case a.INVALID:i(),l(),r()}return t.data("validated",e),e}};var p=function(){return d.validate(a.WAIT),d.hook(t.val(),function(e){e?d.validate(a.PASSED):d.validate(a.INVALID)})},g=function(){if(d.validate(a.VERIFY)==a.PASSED)switch(p()){case a.PASSED:return d.validate(a.PASSED);case a.INVALID:return d.validate(a.PASSED)}};t.change(g),t.keyup(g),t.data("validator",d),o.inputs.push(t)}),t.submit(function(){return d()}),n=!0,!0},l=function(e){return e.replace(/\{/g,"").replace(/\}/g,"").replace(/\\x/g,"\\u").match("/(.*)/")[1]},c=function(e){void 0!=typeof console&&console.log("[Validator] validator stopped due to a problem: "+e+".")},d=function(){var e=!0;for(var t in o.inputs)o.inputs[t].data("validator").validate(a.GET)!=a.PASSED&&(e=!1,alert(o.inputs[t].val()+" : "+o.inputs[t].data("validator").validate(a.GET)));return s.data.lastErrPos=e?{}:o.inputs[t].position(),e},u=function(e,t,i,n){return t&&e.length>t||i&&e.length<i||n&&"undefined"!=typeof o.formats[n]&&!e.match(o.formats[n])?!1:!0};r()};e.fn.validator=function(e){var i=new t(this,e);return i}}(jQuery);