/**
* jQuery Validator Plugin
*
* @copyright    2014 Rain Lee <raincious@gmail.com>
* @author       Rain Lee <raincious@gmail.com>
* @package      jQuery.validator
* @version      0.1.0 alpha
*
* Copyright (c) 2014, Rain Lee
* All rights reserved.
*
* See the uncompressed code for terms.
*
*/

!function(t){var e=function(e,a){var n=!1,i=this,o=!1;i.onSubmit=function(){return!0},i.onSubmitEnable=function(){return!0},i.onWait=i.onPassed=i.onError=function(){},i.data={lastErrPos:{}};var r={WAIT:1,PASSED:2,INVALID:3,VERIFY:4,GET:5,TEST:6,TOUCH:7},s={unsubmitableCss:"",submittingCSS:"",resubmitCSS:"",submitTimeout:12e4,formats:{},inputs:[],binds:{},methods:{length:function(t,e,a){return(!e||t.length<=e)&&(!a||t.length>=a)?!0:void 0},compare:function(t,e,a){return(!e||e>=t)&&(!a||t>=a)?!0:void 0},equal:function(e,a){return objVal=t(a).val(),objVal&&objVal==e?!0:void 0}},events:{Wait:i.onWait,Passed:i.onPassed,Errored:i.onError}},u=function(){if(n)return f("Inited, cannot reinit"),!1;if("undefined"==typeof e)return f("Form must be specified"),!1;if(!e.is("form"))return f("Target not a form"),!1;if("undefined"==typeof a)return f("Option must be defined"),!1;if("undefined"!=typeof a.UnsubmitableCSS&&(s.unsubmitableCss=a.UnsubmitableCSS),"undefined"!=typeof a.submittingCSS&&(s.submittingCSS=a.submittingCSS),"undefined"!=typeof a.resubmitCSS&&(s.resubmitCSS=a.resubmitCSS),"number"!=typeof a.submitTimeout||isNaN(a.submitTimeout)||(s.submitTimeout=parseInt(a.submitTimeout,10)),"object"==typeof a.Format&&a.Format){s.formats=a.Format;for(var u in a.Format)"string"==typeof a.Format[u]?(s.formats[u]=d(a.Format[u]))||f("Format not valid: "+a.Format[u]):f("Format not a string: "+a.Format[u])}if("object"==typeof a.Events&&a.Events)for(var u in a.Events)"function"==typeof a.Events[u]?s.events[u]=a.Events[u]:f("Event "+u+" not a closure, ignoring");if("object"==typeof a.Methods&&a.Methods)for(var u in a.Methods)"function"==typeof a.Methods[u]?s.methods[u]=a.Methods[u]:f("Method "+u+" not a closure, ignoring");if("object"==typeof a.Binds&&a.Binds)for(var u in a.Binds){if("function"!=typeof a.Binds[u])return f("Bind "+u+" not a closure"),!1;s.binds[u]=a.Binds[u]}return s.topOffset="undefined"!=typeof a.topOffset?parseInt(a.topOffset,10):50,("undefined"==typeof a.textAreaAutoExpand||a.textAreaAutoExpand===!1)&&!function(){var a=t("<pre></pre>"),n=["width","minHeight","fontFamily","fontSize","textIndent","whiteSpace","textTransform","letterSpacing","fontStyle","wordSpacing","fontWeight","lineHeight","wordWrap"];a.css({zoom:"1",wordBreak:"break-all",display:"none",whiteSpace:"pre-wrap"}),t("body").append(a);var i=function(t,e){var i=0;for(var o in n)a.css(n[o],t.css(n[o]));a.text(t.val()+'<em style="height: 1px; width: 1px; display: block; float: left;"><!-- Bottom --></em>'),a.html(a.html().replace(/\n/g,"<br />")),a.width(t.width()),i=a.height(),!i||0>i||(e.min&&i<e.min?(i=e.min,t.css("overflowY","")):e.max&&i>e.max?(i=e.max,t.css("overflowY","")):t.css("overflowY","hidden"),t.height(i))},o=function(t){return a.css("width",t),a.width()};e.find(t("textarea")).each(function(){var e=t(this),a={min:e.data("validator-textarea-expand-min")||e.data("va-tah-min")||o(e.css("minHeight"))||e.height(),max:e.data("validator-textarea-expand-max")||e.data("va-tah-max")||o(e.css("maxHeight"))||e.height()},n=!1;if(a.min!=a.max){var r=function(){i(e,a)},s=function(){n||(n=!0,setTimeout(function(){r(),n=!1},50))};e.bind("change input keyup",r),t(window).resize(s),r()}})}(),e.find("input,textarea,select,button").each(function(){var e=t(this),a=function(){},n=function(){},i=function(){},o=function(){},u=function(){},d=function(){},f=function(){},m={Max:e.data("validator-maxlength")||e.data("va-max")||0,Min:e.data("validator-minlength")||e.data("va-min")||0,Type:e.data("validator-type")||e.data("va-type")||"",Method:e.data("validator-method")||e.data("va-method")||"length",Resulter:e.data("validator-resulter")||e.data("va-show")||"",ClickBind:e.data("validator-click")||e.data("va-click")||"",FocusCSS:e.data("validator-focus")||e.data("va-focus")||"focused",WrongCSS:e.data("validator-wrong")||e.data("va-error")||"",WorkingCSS:e.data("validator-working")||e.data("va-working")||"",msgResulter:e.data("validator-messager")||e.data("va-msgr")||"",WrongMSG:e.data("validator-message")||e.data("va-msg")||"",hook:function(){return r.PASSED},setWrong:function(){},dismissWrong:function(){},setWorking:function(){},dismissWorking:function(){},validated:function(){}};if(m.Resulter&&(m.ResulterObj=t(m.Resulter)),m.msgResulter&&(m.msgResulterObj=t(m.msgResulter)),"object"==typeof m.ResulterObj&&m.ResulterObj&&(a=function(){m.ResulterObj.addClass(m.WrongCSS)},n=function(){m.ResulterObj.removeClass(m.WrongCSS)},i=function(){m.ResulterObj.addClass(m.WorkingCSS)},o=function(){m.ResulterObj.removeClass(m.WorkingCSS)},e.focus(function(){m.ResulterObj.addClass(m.FocusCSS)}),e.blur(function(){m.ResulterObj.removeClass(m.FocusCSS)}),"no"!=m.ClickBind&&m.ResulterObj.click(function(){e.focus()})),"object"==typeof m.msgResulterObj&&m.msgResulterObj){var v=m.msgResulterObj.text();u=function(t){m.msgResulterObj.text(t?t:v)},d=function(){u(m.WrongMSG.replace("{max}",m.Max).replace("{min}",m.Min))},f=function(){m.msgResulterObj.text(v)}}for(var b in s.binds)if(e.is(t(b))){m.hook=s.binds[b];break}e.message=u,e.validate=function(t){switch(t){case r.GET:return"undefined"==typeof e.validated?e.validated=e.validate(r.VERIFY):e.validated;case r.TOUCH:return"undefined"==typeof e.validated?e.validate(r.TEST):e.validated;case r.VERIFY:return e.validate(S(e.val(),m.Max,m.Min,m.Type,m.Method)?r.PASSED:r.INVALID);case r.TEST:return S(e.val(),m.Max,m.Min,m.Type,m.Method)?r.PASSED:r.INVALID;default:switch(e.validated=t,t){case r.WAIT:i(),s.events.Wait(e),l(!1);break;case r.PASSED:n(),f(),o(),s.events.Passed(e),c(r.TOUCH);break;case r.INVALID:a(),d(),o(),s.events.Errored(e),l(!1)}return t}};var p=function(){return e.validate(r.WAIT),m.hook(e,function(t){if(t){if(e.validate(r.TEST)===r.PASSED)return e.validate(r.PASSED),!0;e.validate(r.INVALID)}else e.validate(r.INVALID);return!1})},h=function(){var t=e.val();if(e["validate-old"]!==t&&(e["validate-old"]=t,e.validate(r.VERIFY)===r.PASSED))switch(p()){case r.PASSED:return e.validate(r.PASSED);case r.INVALID:return e.validate(r.PASSED)}},g=function(){return e["validate-tested"]!==!0&&e.validate(r.TEST)===r.PASSED&&(e["validate-tested"]=!0),e["validate-tested"]===!0?h():void 0};e.change(h),e.focus(function(){e.val()&&g()}),e.keyup(function(){"undefined"!=typeof e.checkTimer&&clearTimeout(e.checkTimer),e.checkTimer=setTimeout(function(){g()},150)}),e.validator=m,s.inputs.push(e)}),c(r.TEST),e.submit(function(){return v()&&i.onSubmit(e)&&!o?(o=!0,s.submittingCSS&&(s.resubmitCSS&&e.hasClass(s.resubmitCSS)&&e.removeClass(s.resubmitCSS),e.addClass(s.submittingCSS),setTimeout(function(){e.removeClass(s.submittingCSS),s.resubmitCSS&&e.addClass(s.resubmitCSS),o=!1},s.submitTimeout)),!0):("undefined"!=typeof i.data.lastErrPos.top&&t("html, body").animate({scrollTop:i.data.lastErrPos.top-s.topOffset},1e3),!1)}),n=!0,!0},d=function(t){return t=t.replace(/\{/g,"").replace(/\}/g,"").replace(/\\x/g,"\\u").match("/(.*)/"),null!=t?t[1]:!1},f=function(t){void 0!=typeof console&&console.log("[Validator] validator stopped due to a problem: "+t+".")},l=function(t){s.unsubmitableCss&&(t?e.removeClass(s.unsubmitableCss):e.addClass(s.unsubmitableCss)),i.onSubmitEnable(t)},c=function(t){submitable=!1,submitable=m(t)?!0:!1,l(submitable)},m=function(t){result=!0;for(var e in s.inputs)s.inputs[e].validate(t)!==r.PASSED&&(result=!1);return result},v=function(){var t=!0;for(var e in s.inputs)s.inputs[e].validate(r.GET)!=r.PASSED&&(t&&(i.data.lastErrPos=s.inputs[e].offset()),t=!1);return t&&(i.data.lastErrPos={}),t},S=function(t,e,a,n,i){if("string"==typeof t){if(n){if("string"!=typeof s.formats[n])return f("Format "+n+" not found."),!1;if(!t.match(s.formats[n]))return!1}if(i){if("function"!=typeof s.methods[i])return f("Method "+i+" not found."),!1;if(!s.methods[i](t,e,a))return!1}return!0}};return u()};t.fn.validator=function(t){var a=new e(this,t);return a}}(jQuery);
