/*
* jQuery Validator Plugin
*
* @copyright	2013 Rain Lee <raincious@gmail.com>
* @author		Rain Lee <raincious@gmail.com>
* @package		jQuery.validator
* @version		0.0 prototype
* 
* Copyright (c) 2013, Rain Lee
* All rights reserved.
* 
* Redistribution and use in source and binary forms, with or without
* modification, are permitted provided that the following conditions are met: 
* 
* 1. Redistributions of source code must retain the above copyright notice, this
*    list of conditions and the following disclaimer. 
* 2. Redistributions in binary form must reproduce the above copyright notice,
*    this list of conditions and the following disclaimer in the documentation
*    and/or other materials provided with the distribution. 
*
* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
* ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
* WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
* DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
* ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
* (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
* LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
* ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
* (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
* SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*
*/
!function(t){var e=function(e,i){var s=!1,r=this;r.onSubmit=function(){},r.onWait=r.onPassed=r.onError=function(){},r.data={lastErrPos:{}};var n={formats:null,inputs:[],binds:{},events:{Wait:r.onWait,Passed:r.onPassed,Errored:r.onError}},a={WAIT:1,PASSED:2,INVALID:3,VERIFY:4,GET:5,TEST:6},o=function(){if(s)return l("Inited, cannot reinit"),!1;if("undefined"==typeof e)return l("Form must be specified"),!1;if(!e.is("form"))return l("Target not a form"),!1;if("undefined"==typeof i)return l("Option must be defined"),!1;if("undefined"==typeof i.Format)return l("Format not set"),!1;n.formats=i.Format;for(var o in i.Format)n.formats[o]=h(i.Format[o]);if("object"==typeof i.Events)for(var o in i.Events)"function"==typeof i.Events[o]?n.events[o]=i.Events[o]:l("Event "+o+" not a closure, ignoring");if("object"==typeof i.Bind)for(var o in i.Bind){if("function"!=typeof i.Bind[o])return l("Bind "+o+" not a closure"),!1;n.binds[o]=i.Bind[o]}return e.find("input,textarea,select,button").each(function(){var e=t(this),i=function(){},s=function(){},r=function(){},o=function(){},h=function(){},l=function(){},p={Max:e.data("validator-maxlength")||e.data("va-max"),Min:e.data("validator-minlength")||e.data("va-min"),Type:e.data("validator-type")||e.data("va-type"),Resulter:e.data("validator-resulter")||e.data("va-show"),WrongCSS:e.data("validator-wrong")||e.data("va-error"),WorkingCSS:e.data("validator-working")||e.data("va-working"),msgResulter:e.data("validator-messager")||e.data("va-msgr"),WrongMSG:e.data("validator-message")||e.data("va-msg"),hook:function(){return a.PASSED},setWrong:function(){},dismissWrong:function(){},setWorking:function(){},dismissWorking:function(){},validated:function(){}};if(p.Resulter&&(p.ResulterObj=t(p.Resulter)),p.msgResulter&&(p.msgResulterObj=t(p.msgResulter)),"object"==typeof p.ResulterObj&&(i=function(){p.ResulterObj.addClass(p.WrongCSS)},s=function(){p.ResulterObj.removeClass(p.WrongCSS)},r=function(){p.ResulterObj.addClass(p.WorkingCSS)},o=function(){p.ResulterObj.removeClass(p.WorkingCSS)}),"object"==typeof p.msgResulterObj){var c=p.msgResulterObj.text();h=function(){p.msgResulterObj.text(p.WrongMSG)},l=function(){p.msgResulterObj.text(c)}}for(var g in n.binds)if(e.is(t(g))){p.hook=n.binds[g];break}e.validate=function(t){switch(t){case a.GET:var c=e.data("validated");return"undefined"==typeof c?e.validate(a.VERIFY):c;case a.VERIFY:var c=e.validate();return u(e.val(),p.Max,p.Min,p.Type)?e.validate(a.PASSED):e.validate(a.INVALID);case a.TEST:return u(e.val(),p.Max,p.Min,p.Type)?a.PASSED:a.INVALID;default:switch(t){case a.WAIT:r(),n.events.Wait(e);break;case a.PASSED:s(),l(),o(),n.events.Passed(e);break;case a.INVALID:i(),h(),o(),n.events.Errored(e)}return e.data("validated",t),t}};var d=function(){return e.validate(a.WAIT),p.hook(e.val(),function(t){t?e.validate(a.PASSED):e.validate(a.INVALID)})},f=function(){if(e.data("validate-tested")!==!0&&e.validate(a.TEST)==a.PASSED)return e.data("validate-tested",!0),a.WAIT;if(e.data("validate-tested")===!0&&e.validate(a.VERIFY)==a.PASSED)switch(d()){case a.PASSED:return e.validate(a.PASSED);case a.INVALID:return e.validate(a.PASSED)}};e.change(f),e.keyup(f),e.click(f),e.data("validator",p),n.inputs.push(e)}),e.submit(function(){return p()?(r.onSubmit(!0),!0):(r.onSubmit(!1),!1)}),s=!0,!0},h=function(t){return t.replace(/\{/g,"").replace(/\}/g,"").replace(/\\x/g,"\\u").match("/(.*)/")[1]},l=function(t){void 0!=typeof console&&console.log("[Validator] validator stopped due to a problem: "+t+".")},p=function(){var t=!0;for(var e in n.inputs)n.inputs[e].validate(a.GET)!=a.PASSED&&(t&&(r.data.lastErrPos=n.inputs[e].position()),t=!1);return t&&(r.data.lastErrPos={}),t},u=function(t,e,i,s){return e&&t.length>e||i&&t.length<i||s&&"undefined"!=typeof n.formats[s]&&!t.match(n.formats[s])?!1:!0};o()};t.fn.validator=function(i,s){var r={};r="undefined"!=typeof s?{topOffset:"undefined"!=typeof s.topOffset?s.topOffset:50}:{topOffset:50};var n=new e(this,i);return n.onSubmit=function(e){e||"undefined"==typeof n.data.lastErrPos.top||t("html, body").animate({scrollTop:n.data.lastErrPos.top-r.topOffset},1e3)},n}}(jQuery);