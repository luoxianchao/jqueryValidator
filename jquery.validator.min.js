/**
* jQuery Validator Plugin
*
* @copyright    2014 Rain Lee <raincious@gmail.com>
* @author       Rain Lee <raincious@gmail.com>
* @package      jQuery.validator
* @version      0.1.0 alpha
*
* Copyright (c) 2014, Rain Lee
* All rights reserved.
*
* See the uncompressed code for terms.
*
*/

!function(t){var e=function(e,n){var a=!1,i=this,o=!1,r=!1,s=function(){},u=null;i.onSubmit=function(){return!0},i.onSubmitEnable=function(){return!0},i.onWait=i.onPassed=i.onError=function(){},i.data={lastErrPos:{}};var d={RESET:255,WAIT:1,PASSED:2,INVALID:3,VERIFY:4,GET:5,TEST:6,TOUCH:7},l={unsubmitableCSS:"",submittingCSS:"",resubmitCSS:"",submitTimeout:12e4,formats:{},inputs:[],binds:{},submitter:s,methods:{length:function(t,e,n){return(!e||t.length<=e)&&(!n||t.length>=n)?!0:void 0},compare:function(t,e,n){return(!e||e>=t)&&(!n||t>=n)?!0:void 0},equal:function(e,n){return objVal=t(n).val(),objVal&&objVal==e?!0:void 0}},events:{Wait:i.onWait,Passed:i.onPassed,Errored:i.onError}},f=function(){if(a)return m("Inited, cannot reinit"),!1;if("undefined"==typeof e)return m("Form must be specified"),!1;if(!e.is("form"))return m("Target not a form"),!1;if("undefined"==typeof n)return m("Option must be defined"),!1;if("undefined"!=typeof n.UnsubmitableCSS&&(l.unsubmitableCSS=n.UnsubmitableCSS),"undefined"!=typeof n.SubmittingCSS&&(l.submittingCSS=n.SubmittingCSS),"undefined"!=typeof n.ResubmitCSS&&(l.resubmitCSS=n.ResubmitCSS),"number"!=typeof n.SubmitTimeout||isNaN(n.SubmitTimeout)||(l.submitTimeout=parseInt(n.SubmitTimeout,10)),"object"==typeof n.Format&&n.Format){l.formats=n.Format;for(var f in n.Format)"string"==typeof n.Format[f]?(l.formats[f]=c(n.Format[f]))||m("Format not valid: "+n.Format[f]):m("Format not a string: "+n.Format[f])}if("object"==typeof n.Events&&n.Events)for(var f in n.Events)"function"==typeof n.Events[f]?l.events[f]=n.Events[f]:m("Event "+f+" not a closure, ignoring");if("object"==typeof n.Methods&&n.Methods)for(var f in n.Methods)"function"==typeof n.Methods[f]?l.methods[f]=n.Methods[f]:m("Method "+f+" not a closure, ignoring");if("object"==typeof n.Binds&&n.Binds)for(var f in n.Binds){if("function"!=typeof n.Binds[f])return m("Bind "+f+" not a closure"),!1;l.binds[f]=n.Binds[f]}return"function"==typeof n.Submitter&&n.Submitter&&(l.submitter=n.Submitter),l.topOffset="undefined"!=typeof n.TopOffset?parseInt(n.TopOffset,10):50,("undefined"==typeof n.TextAreaAutoExpand||n.TextAreaAutoExpand===!1)&&!function(){var n=t("<pre></pre>"),a=["width","minHeight","fontFamily","fontSize","textIndent","whiteSpace","textTransform","letterSpacing","fontStyle","wordSpacing","fontWeight","lineHeight","wordWrap"];n.css({zoom:"1",wordBreak:"break-all",display:"none",whiteSpace:"pre-wrap"}),t("body").append(n);var i=function(t,e){var i=0;for(var o in a)n.css(a[o],t.css(a[o]));n.text(t.val()+'<em style="height: 1px; width: 1px; display: block; float: left;"><!-- Bottom --></em>'),n.html(n.html().replace(/\n/g,"<br />")),n.width(t.width()),i=n.height(),!i||0>i||(e.min&&i<e.min?(i=e.min,t.css("overflowY","")):e.max&&i>e.max?(i=e.max,t.css("overflowY","")):t.css("overflowY","hidden"),t.height(i))},o=function(t){return n.css("width",t),n.width()};e.find(t("textarea")).each(function(){var e=t(this),n={min:e.data("validator-textarea-expand-min")||e.data("va-tah-min")||o(e.css("minHeight"))||e.height(),max:e.data("validator-textarea-expand-max")||e.data("va-tah-max")||o(e.css("maxHeight"))||e.height()},a=!1;if(n.min!=n.max){var r=function(){i(e,n)},s=function(){a||(a=!0,setTimeout(function(){r(),a=!1},50))};e.bind("change input keyup paste",r),e.bind("propertychange blur focus",s),t(window).resize(s),r()}})}(),e.find("input,textarea,select,button").each(function(){var e=t(this),n=function(){},a=function(){},i=function(){},o=function(){},r=function(){},s=function(){},f=function(){},c={Max:e.data("validator-maxlength")||e.data("va-max")||0,Min:e.data("validator-minlength")||e.data("va-min")||0,Type:e.data("validator-type")||e.data("va-type")||"",Method:e.data("validator-method")||e.data("va-method")||"length",Resulter:e.data("validator-resulter")||e.data("va-show")||"",ClickBind:e.data("validator-click")||e.data("va-click")||"",FocusCSS:e.data("validator-focus")||e.data("va-focus")||"focused",WrongCSS:e.data("validator-wrong")||e.data("va-error")||"",WorkingCSS:e.data("validator-working")||e.data("va-working")||"",msgResulter:e.data("validator-messager")||e.data("va-msgr")||"",WrongMSG:e.data("validator-message")||e.data("va-msg")||"",hook:function(){return d.PASSED},setWrong:function(){},dismissWrong:function(){},setWorking:function(){},dismissWorking:function(){},validated:function(){}};if((e.data("validator-submit")||e.data("va-submit"))&&(u=e),c.Resulter&&(c.ResulterObj=t(c.Resulter)),c.msgResulter&&(c.msgResulterObj=t(c.msgResulter)),"object"==typeof c.ResulterObj&&c.ResulterObj&&(n=function(){c.ResulterObj.addClass(c.WrongCSS)},a=function(){c.ResulterObj.removeClass(c.WrongCSS)},i=function(){c.ResulterObj.addClass(c.WorkingCSS)},o=function(){c.ResulterObj.removeClass(c.WorkingCSS)},e.focus(function(){c.ResulterObj.addClass(c.FocusCSS)}),e.blur(function(){c.ResulterObj.removeClass(c.FocusCSS)}),"no"!=c.ClickBind&&c.ResulterObj.click(function(){e.focus()}),e.keydown(function(t){null!==u&&t.ctrlKey&&(10==t.keyCode||13==t.keyCode)&&u.click()})),"object"==typeof c.msgResulterObj&&c.msgResulterObj){var m=c.msgResulterObj.text();r=function(t){c.msgResulterObj.text(t?t:m)},s=function(){r(c.WrongMSG.replace("{max}",c.Max).replace("{min}",c.Min))},f=function(){c.msgResulterObj.text(m)}}for(var b in l.binds)if(e.is(t(b))){c.hook=l.binds[b];break}e.message=r,e.validate=function(t){switch(t){case d.GET:return"undefined"==typeof e.validated?e.validated=e.validate(d.VERIFY):e.validated;case d.TOUCH:return"undefined"==typeof e.validated?e.validate(d.TEST):e.validated;case d.VERIFY:return e.validate(g(e.val(),c.Max,c.Min,c.Type,c.Method)?d.PASSED:d.INVALID);case d.TEST:return g(e.val(),c.Max,c.Min,c.Type,c.Method)?d.PASSED:d.INVALID;default:switch(e.validated=t,t){case d.RESET:a(),f(),o(),v(d.TOUCH),delete e.validated;break;case d.WAIT:i(),l.events.Wait(e),S(!1);break;case d.PASSED:a(),f(),o(),l.events.Passed(e),v(d.TOUCH);break;case d.INVALID:n(),s(),o(),l.events.Errored(e),S(!1)}return t}};var p=function(){return e.validate(d.WAIT),c.hook(e,function(t){if(t){if(e.validate(d.TEST)===d.PASSED)return e.validate(d.PASSED),!0;e.validate(d.INVALID)}else e.validate(d.INVALID);return!1})},h=function(){var t=e.val();if(e["validate-old"]!==t&&(e["validate-old"]=t,e.validate(d.VERIFY)===d.PASSED))switch(p()){case d.PASSED:return e.validate(d.PASSED);case d.INVALID:return e.validate(d.PASSED)}},C=function(){return e["validate-tested"]!==!0&&e.validate(d.TEST)===d.PASSED&&(e["validate-tested"]=!0),e["validate-tested"]===!0?h():void 0};e.change(h),e.focus(function(){e.val()&&C()}),e.keyup(function(){"undefined"!=typeof e.checkTimer&&clearTimeout(e.checkTimer),e.checkTimer=setTimeout(function(){C()},150)}),e.validator=c,l.inputs.push(e)}),v(d.TEST),e.submit(function(){var n=null;if(a){var u=function(t){l.submittingCSS&&(l.resubmitCSS&&e.hasClass(l.resubmitCSS)&&e.removeClass(l.resubmitCSS),e.addClass(l.submittingCSS),t())},f=function(){e.hasClass(l.submittingCSS)&&e.removeClass(l.submittingCSS),l.resubmitCSS&&l.resubmitCSS&&e.addClass(l.resubmitCSS)};return r=!1,h()?!i.onSubmit(e)||o?!1:(o=!0,null!==n&&(clearTimeout(n),n=null),l.submitter!=s?(l.submitter(function(){b(),v(d.TEST),f(),o=!1,null!==n&&(clearTimeout(n),n=null)}),v(d.TEST),u(function(){n=setTimeout(function(){f(),o=!1},l.submitTimeout)}),!1):(u(function(){n=setTimeout(function(){f(),o=!1},l.submitTimeout)}),!0)):("undefined"!=typeof i.data.lastErrPos.top&&t("html, body").animate({scrollTop:i.data.lastErrPos.top-l.topOffset},1e3),!1)}}),a=!0,!0},c=function(t){return t=t.replace(/\{/g,"").replace(/\}/g,"").replace(/\\x/g,"\\u").match("/(.*)/"),null!=t?t[1]:!1},m=function(t){void 0!=typeof console&&console.log("[Validator] validator stopped due to a problem: "+t+".")},S=function(t){l.unsubmitableCSS&&(t?e.removeClass(l.unsubmitableCSS):e.addClass(l.unsubmitableCSS)),i.onSubmitEnable(t)},v=function(t){r=!1,r=p(t)?!0:!1,S(r)},b=function(){p(d.RESET)},p=function(t){result=!0;for(var e in l.inputs)l.inputs[e].validate(t)!==d.PASSED&&(result=!1);return result},h=function(){var t=!0;for(var e in l.inputs)l.inputs[e].validate(d.GET)!=d.PASSED&&(t&&(i.data.lastErrPos=l.inputs[e].offset()),t=!1);return t&&(i.data.lastErrPos={}),t},g=function(t,e,n,a,i){if("string"==typeof t){if(a){if("string"!=typeof l.formats[a])return m("Format "+a+" not found."),!1;if(!t.match(l.formats[a]))return!1}if(i){if("function"!=typeof l.methods[i])return m("Method "+i+" not found."),!1;if(!l.methods[i](t,e,n))return!1}return!0}};return f()};t.fn.validator=function(t){var n=new e(this,t);return n}}(jQuery);
