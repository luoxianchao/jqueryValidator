/*
* jQuery Validator Plugin
*
* @copyright	2013 Rain Lee <raincious@gmail.com>
* @author		Rain Lee <raincious@gmail.com>
* @package		jQuery.validator
* @version		0.0 prototype
* 
* Copyright (c) 2013, Rain Lee
* All rights reserved.
* 
* Redistribution and use in source and binary forms, with or without
* modification, are permitted provided that the following conditions are met: 
* 
* 1. Redistributions of source code must retain the above copyright notice, this
*    list of conditions and the following disclaimer. 
* 2. Redistributions in binary form must reproduce the above copyright notice,
*    this list of conditions and the following disclaimer in the documentation
*    and/or other materials provided with the distribution. 
*/
!function(e){var t=function(t,i){var s=!1,n=this,o={formats:null,inputs:[],binds:[]},a={WAIT:1,PASSED:2,INVALID:3,VERIFY:4,GET:5};n.data={lastErrPos:{}};var r=function(){if(s)return c("Inited, cannot reinit"),!1;if("undefined"==typeof t)return c("Form must be specified"),!1;if(!t.is("form"))return c("Target not a form"),!1;if("undefined"==typeof i)return c("Option must be defined"),!1;if("undefined"==typeof i.Format)return c("Format not set"),!1;o.formats=i.Format;for(var n in i.Format)o.formats[n]=l(i.Format[n]);if("object"==typeof i.Bind)for(var n in i.Bind){if("function"!=typeof i.Bind[n])return c("Bind "+n+" not a closure"),!1;o.binds[n]=i.Bind[n]}return t.find("input,textarea,select,button").each(function(){var t=e(this),i=function(){},s=function(){},n=function(){},r=function(){},l=function(){},c=function(){},d={Max:t.data("validator-maxlength")||t.data("va-max"),Min:t.data("validator-minlength")||t.data("va-min"),Type:t.data("validator-type")||t.data("va-type"),Resulter:t.data("validator-resulter")||t.data("va-show"),WrongCSS:t.data("validator-wrong")||t.data("va-error"),WorkingCSS:t.data("validator-working")||t.data("va-working"),msgResulter:t.data("validator-messager")||t.data("va-msgr"),WrongMSG:t.data("validator-message")||t.data("va-msg"),hook:function(e,t){return a.PASSED},setWrong:function(){},dismissWrong:function(){},setWorking:function(){},dismissWorking:function(){},validated:function(){}};if(d.Resulter&&(d.ResulterObj=e(d.Resulter)),d.msgResulter&&(d.msgResulterObj=e(d.msgResulter)),"object"==typeof d.ResulterObj&&(i=function(){d.ResulterObj.addClass(d.WrongCSS)},s=function(){d.ResulterObj.removeClass(d.WrongCSS)},n=function(){d.ResulterObj.addClass(d.WorkingCSS)},r=function(){d.ResulterObj.removeClass(d.WorkingCSS)}),"object"==typeof d.msgResulterObj){var h=d.msgResulterObj.text();l=function(){d.msgResulterObj.text(d.WrongMSG)},c=function(){d.msgResulterObj.text(h)}}for(var f in o.binds)if(t.is(e(f))){d.hook=o.binds[f];break}d.validate=function(e){switch(e){case a.GET:var o=t.data("validated");return"undefined"==typeof o?d.validate(a.VERIFY):o;case a.VERIFY:var o=d.validate();return u(t.val(),d.Max,d.Min,d.Type)?d.validate(a.PASSED):d.validate(a.INVALID);default:switch(e){case a.WAIT:n();break;case a.PASSED:s(),c(),r();break;case a.INVALID:i(),l(),r()}return t.data("validated",e),e}};var p=function(){return d.validate(a.WAIT),d.hook(t.val(),function(e){e?d.validate(a.PASSED):d.validate(a.INVALID)})},g=function(){d.validate(a.VERIFY)==a.PASSED&&p()};t.change(g),t.keyup(g),t.data("validator",d),o.inputs.push(t)}),t.submit(function(){return d()}),s=!0,!0},l=function(e){return e.replace(/\{/g,"").replace(/\}/g,"").replace(/\\x/g,"\\u").match("/(.*)/")[1]},c=function(e){void 0!=typeof console&&console.log("[Validator] validator stopped due to a problem: "+e+".")},d=function(){var e=!0;for(var t in o.inputs)o.inputs[t].data("validator").validate(a.GET)!=a.PASSED&&(e=!1);return n.data.lastErrPos=e?{}:o.inputs[t].position(),e},u=function(e,t,i,s){return t&&e.length>t||i&&e.length<i||s&&"undefined"!=typeof o.formats[s]&&!e.match(o.formats[s])?!1:!0};r()};e.fn.validator=function(e){var i=new t(this,e);return i}}(jQuery);