/*
* jQuery Validator Plugin
*
* @copyright	2013 Rain Lee <raincious@gmail.com>
* @author		Rain Lee <raincious@gmail.com>
* @package		jQuery.validator
* @version		0.0 prototype
*
* Copyright (c) 2013, Rain Lee
* All rights reserved.
*
* Redistribution and use in source and binary forms, with or without
* modification, are permitted provided that the following conditions are met:
*
* 1. Redistributions of source code must retain the above copyright notice, this
*    list of conditions and the following disclaimer.
* 2. Redistributions in binary form must reproduce the above copyright notice,
*    this list of conditions and the following disclaimer in the documentation
*    and/or other materials provided with the distribution.
*
* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
* ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
* WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
* DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
* ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
* (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
* LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
* ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
* (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
* SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*
* The views and conclusions contained in the software and documentation are those
* of the authors and should not be interpreted as representing official policies,
* either expressed or implied, of the FreeBSD Project.
*
*/

!function(t){var e=function(e,n){var a=!1,o=this;o.onSubmit=function(){},o.onWait=o.onPassed=o.onError=function(){},o.data={lastErrPos:{}};var r={formats:null,inputs:[],binds:{},methods:{length:function(t,e,n){return(!e||t.length<=e)&&(!n||t.length>=n)?!0:void 0},compare:function(t,e,n){return(!e||e>=t)&&(!n||t>=n)?!0:void 0},equal:function(e,n){return e==t(n).val()?!0:void 0}},events:{Wait:o.onWait,Passed:o.onPassed,Errored:o.onError}},i={WAIT:1,PASSED:2,INVALID:3,VERIFY:4,GET:5,TEST:6},s=function(){if(a)return u("Inited, cannot reinit"),!1;if("undefined"==typeof e)return u("Form must be specified"),!1;if(!e.is("form"))return u("Target not a form"),!1;if("undefined"==typeof n)return u("Option must be defined"),!1;if("undefined"==typeof n.Format)return u("Format not set"),!1;r.formats=n.Format;for(var s in n.Format)r.formats[s]=d(n.Format[s]);if("object"==typeof n.Events)for(var s in n.Events)"function"==typeof n.Events[s]?r.events[s]=n.Events[s]:u("Event "+s+" not a closure, ignoring");if("object"==typeof n.Methods)for(var s in n.Methods)"function"==typeof n.Methods[s]?r.methods[s]=n.Methods[s]:u("Method "+s+" not a closure, ignoring");if("object"==typeof n.Binds)for(var s in n.Binds){if("function"!=typeof n.Binds[s])return u("Bind "+s+" not a closure"),!1;r.binds[s]=n.Binds[s]}return e.find("input,textarea,select,button").each(function(){var e=t(this),n=function(){},a=function(){},o=function(){},s=function(){},d=function(){},u=function(){},f=function(){},c={Max:e.data("validator-maxlength")||e.data("va-max")||0,Min:e.data("validator-minlength")||e.data("va-min")||0,Type:e.data("validator-type")||e.data("va-type")||"",Method:e.data("validator-method")||e.data("va-method")||"length",Resulter:e.data("validator-resulter")||e.data("va-show")||"",WrongCSS:e.data("validator-wrong")||e.data("va-error")||"",WorkingCSS:e.data("validator-working")||e.data("va-working")||"",msgResulter:e.data("validator-messager")||e.data("va-msgr")||"",WrongMSG:e.data("validator-message")||e.data("va-msg")||"",hook:function(){return i.PASSED},setWrong:function(){},dismissWrong:function(){},setWorking:function(){},dismissWorking:function(){},validated:function(){}};if(c.Resulter&&(c.ResulterObj=t(c.Resulter)),c.msgResulter&&(c.msgResulterObj=t(c.msgResulter)),"object"==typeof c.ResulterObj&&(n=function(){c.ResulterObj.addClass(c.WrongCSS)},a=function(){c.ResulterObj.removeClass(c.WrongCSS)},o=function(){c.ResulterObj.addClass(c.WorkingCSS)},s=function(){c.ResulterObj.removeClass(c.WorkingCSS)}),"object"==typeof c.msgResulterObj){var v=c.msgResulterObj.text();d=function(t){c.msgResulterObj.text(t?t:v)},u=function(){d(c.WrongMSG.replace("{max}",c.Max).replace("{min}",c.Min))},f=function(){c.msgResulterObj.text(v)}}for(var m in r.binds)if(e.is(t(m))){c.hook=r.binds[m];break}e.message=d,e.validate=function(t){switch(t){case i.GET:var d=e.validated;return"undefined"==typeof d?e.validate(i.VERIFY):d;case i.VERIFY:return e.validate(l(e.val(),c.Max,c.Min,c.Type,c.Method)?i.PASSED:i.INVALID);case i.TEST:return l(e.val(),c.Max,c.Min,c.Type,c.Method)?i.PASSED:i.INVALID;default:switch(t){case i.WAIT:o(),r.events.Wait(e);break;case i.PASSED:a(),f(),s(),r.events.Passed(e);break;case i.INVALID:n(),u(),s(),r.events.Errored(e)}return e.validated=t,t}};var p=function(){return e.validate(i.WAIT),c.hook(e,function(t){if(t){if(e.validate(i.TEST)==i.PASSED)return e.validate(i.PASSED),!0;e.validate(i.INVALID)}else e.validate(i.INVALID)})},S=function(){if(e.validate(i.VERIFY)==i.PASSED)switch(p()){case i.PASSED:return e.validate(i.PASSED);case i.INVALID:return e.validate(i.PASSED)}},g=function(){return e["validate-tested"]!==!0&&e.validate(i.TEST)==i.PASSED?(e["validate-tested"]=!0,i.WAIT):e["validate-tested"]===!0?S():void 0};e.change(S),e.keyup(g),e.validator=c,r.inputs.push(e)}),e.submit(function(){return f()?(o.onSubmit(!0),!0):(o.onSubmit(!1),!1)}),a=!0,!0},d=function(t){return t.replace(/\{/g,"").replace(/\}/g,"").replace(/\\x/g,"\\u")},u=function(t){void 0!=typeof console&&console.log("[Validator] validator stopped due to a problem: "+t+".")},f=function(){var t=!0;for(var e in r.inputs)r.inputs[e].validate(i.GET)!=i.PASSED&&(t&&(o.data.lastErrPos=r.inputs[e].offset()),t=!1);return t&&(o.data.lastErrPos={}),t},l=function(t,e,n,a,o){return t?a&&"undefined"!=typeof r.formats[a]&&!t.match(r.formats[a])?!1:"function"==typeof r.methods[o]?r.methods[o](t,e,n)?!0:!1:void u("Method "+o+" not found."):n?!1:!0};s()};t.fn.validator=function(n,a){var o={};o="undefined"!=typeof a?{topOffset:"undefined"!=typeof a.topOffset?a.topOffset:50}:{topOffset:50};var r=new e(this,n);return r.onSubmit=function(e){e||"undefined"==typeof r.data.lastErrPos.top||t("html, body").animate({scrollTop:r.data.lastErrPos.top-o.topOffset},1e3)},r}}(jQuery);
