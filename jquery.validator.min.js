/*
* jQuery Validator Plugin
*
* @copyright	2013 Rain Lee <raincious@gmail.com>
* @author		Rain Lee <raincious@gmail.com>
* @package		jQuery.validator
* @version		0.0 prototype
* 
* Copyright (c) 2013, Rain Lee
* All rights reserved.
* 
* Redistribution and use in source and binary forms, with or without
* modification, are permitted provided that the following conditions are met: 
* 
* 1. Redistributions of source code must retain the above copyright notice, this
*    list of conditions and the following disclaimer. 
* 2. Redistributions in binary form must reproduce the above copyright notice,
*    this list of conditions and the following disclaimer in the documentation
*    and/or other materials provided with the distribution. 
* 
* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
* ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
* WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
* DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
* ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
* (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
* LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
* ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
* (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
* SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
* 
* The views and conclusions contained in the software and documentation are those
* of the authors and should not be interpreted as representing official policies, 
* either expressed or implied, of the FreeBSD Project.
* 
*/

!function(t){var e=function(e,i){var n=!1,s=this;s.onSubmit=function(){},s.onWait=s.onPassed=s.onError=function(){},s.data={lastErrPos:{}};var a={formats:null,inputs:[],binds:{},methods:{length:function(t,e,i){return(!e||t.length<=e)&&(!i||t.length>=i)?!0:void 0},compare:function(t,e,i){return(!e||e>=t)&&(!i||t>=i)?!0:void 0},equal:function(e,i){return e==t(i).val()?!0:void 0}},events:{Wait:s.onWait,Passed:s.onPassed,Errored:s.onError}},o={WAIT:1,PASSED:2,INVALID:3,VERIFY:4,GET:5,TEST:6},r=function(){if(n)return c("Inited, cannot reinit"),!1;if("undefined"==typeof e)return c("Form must be specified"),!1;if(!e.is("form"))return c("Target not a form"),!1;if("undefined"==typeof i)return c("Option must be defined"),!1;if("undefined"==typeof i.Format)return c("Format not set"),!1;a.formats=i.Format;for(var r in i.Format)a.formats[r]=l(i.Format[r]);if("object"==typeof i.Events)for(var r in i.Events)"function"==typeof i.Events[r]?a.events[r]=i.Events[r]:c("Event "+r+" not a closure, ignoring");if("object"==typeof i.Methods)for(var r in i.Methods)"function"==typeof i.Methods[r]?a.methods[r]=i.Methods[r]:c("Method "+r+" not a closure, ignoring");if("object"==typeof i.Binds)for(var r in i.Binds){if("function"!=typeof i.Binds[r])return c("Bind "+r+" not a closure"),!1;a.binds[r]=i.Binds[r]}return e.find("input,textarea,select,button").each(function(){var e=t(this),i=function(){},n=function(){},s=function(){},r=function(){},l=function(){},c=function(){},h=function(){},u={Max:e.data("validator-maxlength")||e.data("va-max")||0,Min:e.data("validator-minlength")||e.data("va-min")||0,Type:e.data("validator-type")||e.data("va-type")||"",Method:e.data("validator-method")||e.data("va-method")||"length",Resulter:e.data("validator-resulter")||e.data("va-show")||"",WrongCSS:e.data("validator-wrong")||e.data("va-error")||"",WorkingCSS:e.data("validator-working")||e.data("va-working")||"",msgResulter:e.data("validator-messager")||e.data("va-msgr")||"",WrongMSG:e.data("validator-message")||e.data("va-msg")||"",hook:function(){return o.PASSED},setWrong:function(){},dismissWrong:function(){},setWorking:function(){},dismissWorking:function(){},validated:function(){}};if(u.Resulter&&(u.ResulterObj=t(u.Resulter)),u.msgResulter&&(u.msgResulterObj=t(u.msgResulter)),"object"==typeof u.ResulterObj&&(i=function(){u.ResulterObj.addClass(u.WrongCSS)},n=function(){u.ResulterObj.removeClass(u.WrongCSS)},s=function(){u.ResulterObj.addClass(u.WorkingCSS)},r=function(){u.ResulterObj.removeClass(u.WorkingCSS)}),"object"==typeof u.msgResulterObj){var p=u.msgResulterObj.text();l=function(t){t?u.msgResulterObj.text(t):u.msgResulterObj.text(p)},c=function(){l(u.WrongMSG.replace("{max}",u.Max).replace("{min}",u.Min))},h=function(){u.msgResulterObj.text(p)}}for(var f in a.binds)if(e.is(t(f))){u.hook=a.binds[f];break}e.message=l,e.validate=function(t){switch(t){case o.GET:var l=e.validated;return"undefined"==typeof l?e.validate(o.VERIFY):l;case o.VERIFY:return d(e.val(),u.Max,u.Min,u.Type,u.Method)?e.validate(o.PASSED):e.validate(o.INVALID);case o.TEST:return d(e.val(),u.Max,u.Min,u.Type,u.Method)?o.PASSED:o.INVALID;default:switch(t){case o.WAIT:s(),a.events.Wait(e);break;case o.PASSED:n(),h(),r(),a.events.Passed(e);break;case o.INVALID:i(),c(),r(),a.events.Errored(e)}return e.validated=t,t}};var g=function(){return e.validate(o.WAIT),u.hook(e,function(t){if(t){if(e.validate(o.TEST)==o.PASSED)return e.validate(o.PASSED),!0;e.validate(o.INVALID)}else e.validate(o.INVALID)})},m=function(){if(e.validate(o.VERIFY)==o.PASSED)switch(g()){case o.PASSED:return e.validate(o.PASSED);case o.INVALID:return e.validate(o.PASSED)}},v=function(){return e["validate-tested"]!==!0&&e.validate(o.TEST)==o.PASSED?(e["validate-tested"]=!0,o.WAIT):e["validate-tested"]===!0?m():void 0};e.change(m),e.keyup(v),e.validator=u,a.inputs.push(e)}),e.submit(function(){return h()?(s.onSubmit(!0),!0):(s.onSubmit(!1),!1)}),n=!0,!0},l=function(t){return t.replace(/\{/g,"").replace(/\}/g,"").replace(/\\x/g,"\\u").match("/(.*)/")[1]},c=function(t){void 0!=typeof console&&console.log("[Validator] validator stopped due to a problem: "+t+".")},h=function(){var t=!0;for(var e in a.inputs)a.inputs[e].validate(o.GET)!=o.PASSED&&(t&&(s.data.lastErrPos=a.inputs[e].offset()),t=!1);return t&&(s.data.lastErrPos={}),t},d=function(t,e,i,n,s){return n&&"undefined"!=typeof a.formats[n]&&!t.match(a.formats[n])?!1:"function"==typeof a.methods[s]?a.methods[s](t,e,i)?!0:!1:(c("Method "+s+" not found."),void 0)};r()};t.fn.validator=function(i,n){var s={};s="undefined"!=typeof n?{topOffset:"undefined"!=typeof n.topOffset?n.topOffset:50}:{topOffset:50};var a=new e(this,i);return a.onSubmit=function(e){e||"undefined"==typeof a.data.lastErrPos.top||t("html, body").animate({scrollTop:a.data.lastErrPos.top-s.topOffset},1e3)},a}}(jQuery);