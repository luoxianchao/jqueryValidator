/*
* jQuery Validator Plugin
*
* @copyright	2013 Rain Lee <raincious@gmail.com>
* @author		Rain Lee <raincious@gmail.com>
* @package		jQuery.validator
* @version		0.0 prototype
* 
* Copyright (c) 2013, Rain Lee
* All rights reserved.
* 
* Redistribution and use in source and binary forms, with or without
* modification, are permitted provided that the following conditions are met: 
* 
* 1. Redistributions of source code must retain the above copyright notice, this
*    list of conditions and the following disclaimer. 
* 2. Redistributions in binary form must reproduce the above copyright notice,
*    this list of conditions and the following disclaimer in the documentation
*    and/or other materials provided with the distribution. 
*
* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
* ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
* WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
* DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
* ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
* (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
* LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
* ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
* (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
* SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*
*/
!function(t){var e=function(e,i){var a=!1,n=this,r={formats:null,inputs:[],binds:[]},o={WAIT:1,PASSED:2,INVALID:3,VERIFY:4,GET:5};n.data={lastErrPos:{}};var s=function(){if(a)return h("Inited, cannot reinit"),!1;if("undefined"==typeof e)return h("Form must be specified"),!1;if(!e.is("form"))return h("Target not a form"),!1;if("undefined"==typeof i)return h("Option must be defined"),!1;if("undefined"==typeof i.Format)return h("Format not set"),!1;r.formats=i.Format;for(var n in i.Format)r.formats[n]=l(i.Format[n]);if("object"==typeof i.Bind)for(var n in i.Bind){if("function"!=typeof i.Bind[n])return h("Bind "+n+" not a closure"),!1;r.binds[n]=i.Bind[n]}return e.find("input,textarea,select,button").each(function(){var e=t(this),i=function(){},a=function(){},n=function(){},s=function(){},l=function(){},h=function(){},c={Max:e.data("validator-maxlength")||e.data("va-max"),Min:e.data("validator-minlength")||e.data("va-min"),Type:e.data("validator-type")||e.data("va-type"),Resulter:e.data("validator-resulter")||e.data("va-show"),WrongCSS:e.data("validator-wrong")||e.data("va-error"),WorkingCSS:e.data("validator-working")||e.data("va-working"),msgResulter:e.data("validator-messager")||e.data("va-msgr"),WrongMSG:e.data("validator-message")||e.data("va-msg"),hook:function(){return o.PASSED},setWrong:function(){},dismissWrong:function(){},setWorking:function(){},dismissWorking:function(){},validated:function(){}};if(c.Resulter&&(c.ResulterObj=t(c.Resulter)),c.msgResulter&&(c.msgResulterObj=t(c.msgResulter)),"object"==typeof c.ResulterObj&&(i=function(){c.ResulterObj.addClass(c.WrongCSS)},a=function(){c.ResulterObj.removeClass(c.WrongCSS)},n=function(){c.ResulterObj.addClass(c.WorkingCSS)},s=function(){c.ResulterObj.removeClass(c.WorkingCSS)}),"object"==typeof c.msgResulterObj){var u=c.msgResulterObj.text();l=function(){c.msgResulterObj.text(c.WrongMSG)},h=function(){c.msgResulterObj.text(u)}}for(var p in r.binds)if(e.is(t(p))){c.hook=r.binds[p];break}c.validate=function(t){switch(t){case o.GET:var r=e.data("validated");return"undefined"==typeof r?c.validate(o.VERIFY):r;case o.VERIFY:var r=c.validate();return d(e.val(),c.Max,c.Min,c.Type)?c.validate(o.PASSED):c.validate(o.INVALID);default:switch(t){case o.WAIT:n();break;case o.PASSED:a(),h(),s();break;case o.INVALID:i(),l(),s()}return e.data("validated",t),t}};var f=function(){return c.validate(o.WAIT),c.hook(e.val(),function(t){t?c.validate(o.PASSED):c.validate(o.INVALID)})},g=function(){if(c.validate(o.VERIFY)==o.PASSED)switch(f()){case o.PASSED:return c.validate(o.PASSED);case o.INVALID:return c.validate(o.PASSED)}};e.change(g),e.keyup(g),e.data("validator",c),r.inputs.push(e)}),e.submit(function(){return c()}),a=!0,!0},l=function(t){return t.replace(/\{/g,"").replace(/\}/g,"").replace(/\\x/g,"\\u").match("/(.*)/")[1]},h=function(t){void 0!=typeof console&&console.log("[Validator] validator stopped due to a problem: "+t+".")},c=function(){var t=!0;for(var e in r.inputs)r.inputs[e].data("validator").validate(o.GET)!=o.PASSED&&(t=!1);return n.data.lastErrPos=t?{}:r.inputs[e].position(),t},d=function(t,e,i,a){return e&&t.length>e||i&&t.length<i||a&&"undefined"!=typeof r.formats[a]&&!t.match(r.formats[a])?!1:!0};s()};t.fn.validator=function(t){var i=new e(this,t);return i}}(jQuery);