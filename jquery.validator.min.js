/*
* jQuery Validator Plugin
*
* @copyright	2013 Rain Lee <raincious@gmail.com>
* @author		Rain Lee <raincious@gmail.com>
* @package		jQuery.validator
* @version		0.0 prototype
* 
* Copyright (c) 2013, Rain Lee
* All rights reserved.
* 
* Redistribution and use in source and binary forms, with or without
* modification, are permitted provided that the following conditions are met: 
* 
* 1. Redistributions of source code must retain the above copyright notice, this
*    list of conditions and the following disclaimer. 
* 2. Redistributions in binary form must reproduce the above copyright notice,
*    this list of conditions and the following disclaimer in the documentation
*    and/or other materials provided with the distribution. 
* 
* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
* ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
* WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
* DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
* ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
* (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
* LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
* ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
* (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
* SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
* 
* The views and conclusions contained in the software and documentation are those
* of the authors and should not be interpreted as representing official policies, 
* either expressed or implied, of the FreeBSD Project.
* 
*/

!function(e){var t=function(t,n){var a=!1,i=this;i.onSubmit=function(){},i.onWait=i.onPassed=i.onError=function(){},i.data={lastErrPos:{}};var o={formats:null,inputs:[],binds:{},methods:{length:function(e,t,n){return(!t||e.length<=t)&&(!n||e.length>=n)?!0:void 0},compare:function(e,t,n){return(!t||t>=e)&&(!n||e>=n)?!0:void 0},equal:function(t,n){return t==e(n).val()?!0:void 0}},events:{Wait:i.onWait,Passed:i.onPassed,Errored:i.onError}},s={WAIT:1,PASSED:2,INVALID:3,VERIFY:4,GET:5,TEST:6},r=function(){if(a)return c("Inited, cannot reinit"),!1;if("undefined"==typeof t)return c("Form must be specified"),!1;if(!t.is("form"))return c("Target not a form"),!1;if("undefined"==typeof n)return c("Option must be defined"),!1;if("undefined"==typeof n.Format)return c("Format not set"),!1;o.formats=n.Format;for(var r in n.Format)o.formats[r]=l(n.Format[r]);if("object"==typeof n.Events)for(var r in n.Events)"function"==typeof n.Events[r]?o.events[r]=n.Events[r]:c("Event "+r+" not a closure, ignoring");if("object"==typeof n.Methods)for(var r in n.Methods)"function"==typeof n.Methods[r]?o.methods[r]=n.Methods[r]:c("Method "+r+" not a closure, ignoring");if("object"==typeof n.Binds)for(var r in n.Binds){if("function"!=typeof n.Binds[r])return c("Bind "+r+" not a closure"),!1;o.binds[r]=n.Binds[r]}return t.find("input,textarea,select,button").each(function(){var t=e(this),n=function(){},a=function(){},i=function(){},r=function(){},l=function(){},c=function(){},d=function(){},p={Max:t.data("validator-maxlength")||t.data("va-max")||0,Min:t.data("validator-minlength")||t.data("va-min")||0,Type:t.data("validator-type")||t.data("va-type")||"",Method:t.data("validator-method")||t.data("va-method")||"length",Resulter:t.data("validator-resulter")||t.data("va-show")||"",WrongCSS:t.data("validator-wrong")||t.data("va-error")||"",WorkingCSS:t.data("validator-working")||t.data("va-working")||"",msgResulter:t.data("validator-messager")||t.data("va-msgr")||"",WrongMSG:t.data("validator-message")||t.data("va-msg")||"",hook:function(){return s.PASSED},setWrong:function(){},dismissWrong:function(){},setWorking:function(){},dismissWorking:function(){},validated:function(){}};if(p.Resulter&&(p.ResulterObj=e(p.Resulter)),p.msgResulter&&(p.msgResulterObj=e(p.msgResulter)),"object"==typeof p.ResulterObj&&(n=function(){p.ResulterObj.addClass(p.WrongCSS)},a=function(){p.ResulterObj.removeClass(p.WrongCSS)},i=function(){p.ResulterObj.addClass(p.WorkingCSS)},r=function(){p.ResulterObj.removeClass(p.WorkingCSS)}),"object"==typeof p.msgResulterObj){var m=p.msgResulterObj.text();l=function(e){e?p.msgResulterObj.text(e):p.msgResulterObj.text(m)},c=function(){l(p.WrongMSG.replace("{max}",p.Max).replace("{min}",p.Min))},d=function(){p.msgResulterObj.text(m)}}for(var v in o.binds)if(t.is(e(v))){p.hook=o.binds[v];break}t.message=l,t.validate=function(e){switch(e){case s.GET:var l=t.validated;return"undefined"==typeof l?t.validate(s.VERIFY):l;case s.VERIFY:var l=t.validate();return u(t.val(),p.Max,p.Min,p.Type,p.Method)?t.validate(s.PASSED):t.validate(s.INVALID);case s.TEST:return u(t.val(),p.Max,p.Min,p.Type,p.Method)?s.PASSED:s.INVALID;default:switch(e){case s.WAIT:i(),o.events.Wait(t);break;case s.PASSED:a(),d(),r(),o.events.Passed(t);break;case s.INVALID:n(),c(),r(),o.events.Errored(t)}return t.validated=e,e}};var f=function(){return t.validate(s.WAIT),p.hook(t,function(e){e?t.validate(s.PASSED):t.validate(s.INVALID)})},h=function(){if(t.validate(s.VERIFY)==s.PASSED)switch(f()){case s.PASSED:return t.validate(s.PASSED);case s.INVALID:return t.validate(s.PASSED)}},g=function(){return t["validate-tested"]!==!0&&t.validate(s.TEST)==s.PASSED?(t["validate-tested"]=!0,s.WAIT):t["validate-tested"]===!0?h():void 0};t.change(h),t.keyup(g),t.click(g),t.validator=p,o.inputs.push(t)}),t.submit(function(){return d()?(i.onSubmit(!0),!0):(i.onSubmit(!1),!1)}),a=!0,!0},l=function(e){return e.replace(/\{/g,"").replace(/\}/g,"").replace(/\\x/g,"\\u").match("/(.*)/")[1]},c=function(e){void 0!=typeof console&&console.log("[Validator] validator stopped due to a problem: "+e+".")},d=function(){var e=!0;for(var t in o.inputs)o.inputs[t].validate(s.GET)!=s.PASSED&&(e&&(i.data.lastErrPos=o.inputs[t].offset()),e=!1);return e&&(i.data.lastErrPos={}),e},u=function(e,t,n,a,i){return a&&"undefined"!=typeof o.formats[a]&&!e.match(o.formats[a])?!1:"function"==typeof o.methods[i]?o.methods[i](e,t,n)?!0:!1:(c("Method "+i+" not found."),void 0)};r()};e.fn.validator=function(n,a){var i={};i="undefined"!=typeof a?{topOffset:"undefined"!=typeof a.topOffset?a.topOffset:50}:{topOffset:50};var o=new t(this,n);return o.onSubmit=function(t){t||"undefined"==typeof o.data.lastErrPos.top||e("html, body").animate({scrollTop:o.data.lastErrPos.top-i.topOffset},1e3)},o}}(jQuery);