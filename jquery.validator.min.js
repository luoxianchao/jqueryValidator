/**
* jQuery Validator Plugin
*
* @copyright    2014 Rain Lee <raincious@gmail.com>
* @author       Rain Lee <raincious@gmail.com>
* @package      jQuery.validator
* @version      0.1.0 alpha
*
* Copyright (c) 2014, Rain Lee
* All rights reserved.
*
* See the uncompressed code for terms.
*
*/

!function(t){var e=function(e,n){var a=!1,o=this;o.onSubmit=function(){},o.onSubmitEnable=function(){},o.onWait=o.onPassed=o.onError=function(){},o.data={lastErrPos:{}};var i={WAIT:1,PASSED:2,INVALID:3,VERIFY:4,GET:5,TEST:6,TOUCH:7},r={unsubmitableCss:"",formats:null,inputs:[],binds:{},methods:{length:function(t,e,n){return(!e||t.length<=e)&&(!n||t.length>=n)?!0:void 0},compare:function(t,e,n){return(!e||e>=t)&&(!n||t>=n)?!0:void 0},equal:function(e,n){return objVal=t(n).val(),objVal&&objVal==e?!0:void 0}},events:{Wait:o.onWait,Passed:o.onPassed,Errored:o.onError}},s=function(){if(a)return d("Inited, cannot reinit"),!1;if("undefined"==typeof e)return d("Form must be specified"),!1;if(!e.is("form"))return d("Target not a form"),!1;if("undefined"==typeof n)return d("Option must be defined"),!1;if("undefined"!=typeof n.UnsubmitableCSS&&(r.unsubmitableCss=n.UnsubmitableCSS),"undefined"==typeof n.Format)return d("Format not set"),!1;r.formats=n.Format;for(var s in n.Format)"string"==typeof n.Format[s]?(r.formats[s]=u(n.Format[s]))||d("Format not valid: "+n.Format[s]):d("Format not a string: "+n.Format[s]);if("object"==typeof n.Events)for(var s in n.Events)"function"==typeof n.Events[s]?r.events[s]=n.Events[s]:d("Event "+s+" not a closure, ignoring");if("object"==typeof n.Methods)for(var s in n.Methods)"function"==typeof n.Methods[s]?r.methods[s]=n.Methods[s]:d("Method "+s+" not a closure, ignoring");if("object"==typeof n.Binds)for(var s in n.Binds){if("function"!=typeof n.Binds[s])return d("Bind "+s+" not a closure"),!1;r.binds[s]=n.Binds[s]}return e.find("input,textarea,select,button").each(function(){var e=t(this),n=function(){},a=function(){},o=function(){},s=function(){},u=function(){},d=function(){},c=function(){},v={Max:e.data("validator-maxlength")||e.data("va-max")||0,Min:e.data("validator-minlength")||e.data("va-min")||0,Type:e.data("validator-type")||e.data("va-type")||"",Method:e.data("validator-method")||e.data("va-method")||"length",Resulter:e.data("validator-resulter")||e.data("va-show")||"",WrongCSS:e.data("validator-wrong")||e.data("va-error")||"",WorkingCSS:e.data("validator-working")||e.data("va-working")||"",msgResulter:e.data("validator-messager")||e.data("va-msgr")||"",WrongMSG:e.data("validator-message")||e.data("va-msg")||"",hook:function(){return i.PASSED},setWrong:function(){},dismissWrong:function(){},setWorking:function(){},dismissWorking:function(){},validated:function(){}};if(v.Resulter&&(v.ResulterObj=t(v.Resulter)),v.msgResulter&&(v.msgResulterObj=t(v.msgResulter)),"object"==typeof v.ResulterObj&&(n=function(){v.ResulterObj.addClass(v.WrongCSS)},a=function(){v.ResulterObj.removeClass(v.WrongCSS)},o=function(){v.ResulterObj.addClass(v.WorkingCSS)},s=function(){v.ResulterObj.removeClass(v.WorkingCSS)}),"object"==typeof v.msgResulterObj){var b=v.msgResulterObj.text();u=function(t){v.msgResulterObj.text(t?t:b)},d=function(){u(v.WrongMSG.replace("{max}",v.Max).replace("{min}",v.Min))},c=function(){v.msgResulterObj.text(b)}}for(var S in r.binds)if(e.is(t(S))){v.hook=r.binds[S];break}e.message=u,e.validate=function(t){switch(t){case i.GET:return"undefined"==typeof e.validated?e.validated=e.validate(i.VERIFY):e.validated;case i.TOUCH:return"undefined"==typeof e.validated?e.validate(i.TEST):e.validated;case i.VERIFY:return e.validate(m(e.val(),v.Max,v.Min,v.Type,v.Method)?i.PASSED:i.INVALID);case i.TEST:return m(e.val(),v.Max,v.Min,v.Type,v.Method)?i.PASSED:i.INVALID;default:switch(e.validated=t,t){case i.WAIT:o(),r.events.Wait(e),f(!1);break;case i.PASSED:a(),c(),s(),r.events.Passed(e),l(i.TOUCH);break;case i.INVALID:n(),d(),s(),r.events.Errored(e),f(!1)}return t}};var p=function(){return e.validate(i.WAIT),v.hook(e,function(t){if(t){if(e.validate(i.TEST)===i.PASSED)return e.validate(i.PASSED),!0;e.validate(i.INVALID)}else e.validate(i.INVALID)})},g=function(){var t=e.val();if(e["validate-old"]!==t&&(e["validate-old"]=t,e.validate(i.VERIFY)===i.PASSED))switch(p()){case i.PASSED:return e.validate(i.PASSED);case i.INVALID:return e.validate(i.PASSED)}},E=function(){return e["validate-tested"]!==!0&&e.validate(i.TEST)===i.PASSED&&(e["validate-tested"]=!0),e["validate-tested"]===!0?g():void 0};e.change(g),e.keyup(function(){"undefined"!=typeof e.checkTimer&&clearTimeout(e.checkTimer),e.checkTimer=setTimeout(function(){E()},150)}),e.validator=v,r.inputs.push(e)}),l(i.TEST),e.submit(function(){return v()?(o.onSubmit(!0),!0):(o.onSubmit(!1),!1)}),a=!0,!0},u=function(t){return t=t.replace(/\{/g,"").replace(/\}/g,"").replace(/\\x/g,"\\u").match("/(.*)/"),null!=t?t[1]:!1},d=function(t){void 0!=typeof console&&console.log("[Validator] validator stopped due to a problem: "+t+".")},f=function(t){r.unsubmitableCss&&(t?e.removeClass(r.unsubmitableCss):e.addClass(r.unsubmitableCss)),o.onSubmitEnable(t)},l=function(t){submitable=!1,submitable=c(t)?!0:!1,f(submitable)},c=function(t){result=!0;for(var e in r.inputs)r.inputs[e].validate(t)!==i.PASSED&&(result=!1);return result},v=function(){var t=!0;for(var e in r.inputs)r.inputs[e].validate(i.GET)!=i.PASSED&&(t&&(o.data.lastErrPos=r.inputs[e].offset()),t=!1);return t&&(o.data.lastErrPos={}),t},m=function(t,e,n,a,o){if("string"==typeof t){if(a){if("undefined"==typeof r.formats[a])return d("Format "+a+" not found."),!1;if(!t.match(r.formats[a]))return!1}if(o){if("function"!=typeof r.methods[o])return d("Method "+o+" not found."),!1;if(!r.methods[o](t,e,n))return!1}return!0}};s()};t.fn.validator=function(n,a){var o={};o="undefined"!=typeof a?{topOffset:"undefined"!=typeof a.topOffset?a.topOffset:50}:{topOffset:50};var i=new e(this,n);return i.onSubmit=function(e){e||"undefined"==typeof i.data.lastErrPos.top||t("html, body").animate({scrollTop:i.data.lastErrPos.top-o.topOffset},1e3)},i}}(jQuery);
